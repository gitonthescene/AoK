I:0:"day8.txt"

D:.''","\'I
oo:`b$0 1+\:&#D
dist:{+/x*x:-/x}''D@prs:,/:/'+(!#D;&'&\~=#D)
sz:-1_0,+\#'dist
fnd:{(y;x-sz[y])}/1(sz')\
lst:fnd'<,/dist

r:*/3#@/1>:\.#'={@[x;&w;:;#[+/w;,w:|/[x[y]]&oo@~.[x;y]]]}/[`b$=#D;(@/1(<D@)\)'1000#prs .[;]/:lst]

(t;c):(~&//*:){(a;b):y;(@[a;&w;:;#[+/w;,w:|/[a[x b]]&oo@~.[a;x b]]];b+1)}[w:(@/1(<D@)\)'prs .[;]/:lst]/(`b$=#D;0);

(r;*/*'D@w@c-1)
