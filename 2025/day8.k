I:0:"day8.txt"

D:.''","\'I
oo:`b$0 1+\:&#D
dist:{+/x*x:-/x}''D@prs:,/:/'+(!#D;&'&\~=#D)
sz:-1_0,+\#'dist
fnd:{(y;x-sz[y])}/1(sz')\
lst:prs .[;]/:fnd'<,/dist

r:*/3#@/1>:\.#'={@[x;&w;:;#[+/w;,w:|/[x[y]]&oo@~.[x;y]]]}/[`b$=#D;1000#lst]
(t;c):(~&//*:){(a;b):y;(@[a;&w;:;#[+/w;,w:|/[a[x b]]&oo@~.[a;x b]]];b+1)}[lst]/(`b$=#D;0)

(r;*/*'D@lst@c-1)
