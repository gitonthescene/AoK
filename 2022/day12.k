I:0:"day12.txt"
(s;e):(*+&)'"SE"=\:I
I:.[;;:;]/[I;(s;e);"az"]
sh:-1_#'*:\I
dr:,/-:\=2
d:sh#0N

st:{(1_w)@&((~^m)&-2<)@(*h)-m:1_h:.[I;]'w:x+/:0,dr}
n:{@/1(*<d./:)\x}
u:{(.[;;:;1+x.(y)]/[x;a];a:w@&^x./:w:st@y)}
dj0:{(d;a):u[x;p:n@y];(d;(p~/:)_y,a)}

dj:{.[*{(~e~n@*|x)&#*|x}{dj0.(x)}/(.[;;:;0]/[d;x];x);e]}
dj[,s]
dj[+&"a"=I]
