I:1:"day13.txt"

(L;V):++'":"\''"\n"\'"\n\n"\I
V:`I$3_/:/:/:","\''V
V:{(+x;*y)}/'0 2_/:V

mm:(+/*)\:
det:-/*/{|y}\
inv:{((-1+2*=2)*|+|x)%det[x]}

+//3 1*+{x@&y}/+{(m;x):x;(*|a;|/1e-10>{x|-x}@-/a:1(_0.5+)\mm[inv[m];x])}'V
+//3 1*+{x@&y}/2#+{(m;x):x;(*|a;~/(10000000000000+x;mm[m;*|a]);|/1e-4>{x|-x}@-/a:1(_0.5+)\mm[inv[m];10000000000000+x])}'V
