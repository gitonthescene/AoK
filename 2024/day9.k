I:-1_1:"day9.txt"
I:.'I,"0"

i:-2!*/1(~2!)\2+!#I
m:#/:/|1(&/#:')\{|y}\&'~:\~R:i@&I
+/*/1(!#:)\0|-1+{@[R;x;:;|(0;R x 1)]}@@\:/1(&</)\m

rid:+*|{x[0;0]<#*x}{(y;l):y
 w:*>x*&/(x>0;y<#y)
 g:*>&/(y*~x;~y<y@w)
 $[(2!g)&g<w;[y:@[y;g;-;y@w];l,:,(w;g)];]
 y:@[y;w;:;#y]
 (y;l)}[i]/(I;!0)

s:*'(ss:0,+\I)@?rid 1
s+:-1_/:0,/:+\'l:I@m:rid[0]@=rid 1

+/*/1(!#:)\0|-1+@[R;,//'(ss[m];s)+'\:!''l;:;(0;,/i[m]@'&'l)]
