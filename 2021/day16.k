/ ngn/k
t:*0:"day16.txt"

bts:,/+2\."0x",,/+((#t)#"0";_t)
lt:{(6++/#'b;2/,/1_'b:(1+(l@5*!_(#l)%5)?0;5)#l:x)}
ev:{b:(x@2)_*x;(v;t):2/'2 3#b
    $[t=4;:(,*x),@[v,lt 6_b;!2;+;x[1 2]]
    [l:(:/)a:$[b@6
              (2/11#7_b)o\(*x;x@1;(x@2)+18;0)
              {x>y@2}[22+(x@2)+2/15#7_b]o\(*x;x@1;(x@2)+22;0)]
     @[l;1 3;:;(v+l@1;(+;*;&;|;0N;>;<;=)[t]/*|+1_a)]]]}
r:ev (bts;0;0;0)
r[1 3]

\\
